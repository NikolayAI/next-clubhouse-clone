'use strict';function e(e,r){for(var n in e)r(e[n],n)}function r(e,r){e.forEach(r)}function n(e,r){if(!e)throw Error(r)}function t(e,r){ye={parent:ye,value:e,template:me(e,'template')||be(),sidRoot:me(e,'sidRoot')||ye&&ye.sidRoot};try{return r()}finally{ye=pe(ye)}}function a(e){var n=void 0===e?{}:e,t=n.node,a=void 0===t?[]:t,o=n.parent,i=n.child,u=void 0===i?n.to||n.target:i,f=n.scope,c=void 0===f?{}:f,s=n.meta,l=void 0===s?{}:s,d=n.family,p=void 0===d?{type:'regular'}:d,v=n.regional,m=ke(void 0===o?n.from||n.source:o),g=ke(p.links),h=ke(p.owners),y=[];r(a,(function(e){return e&&R(y,e)}));var b={id:H(),seq:y,next:ke(u),meta:l,scope:c,family:{type:p.type||"crosslink",links:g,owners:h}};return r(g,(function(e){return R(fe(e),b)})),r(h,(function(e){return R(ce(e),b)})),r(m,(function(e){return R(e.next,b)})),v&&ye&&he(le(ye),[b]),b}function o(e,n,t){var a=Re,o=null,i=Me;if(e.target&&(n=e.params,t=e.defer,a='page'in e?e.page:a,e.stack&&(o=e.stack),i=ve(e)||i,e=e.target),i&&Me&&i!==Me&&(Me=null),Array.isArray(e))for(var u=0;u<e.length;u++)Ie('pure',a,ue(e[u]),o,n[u],i);else Ie('pure',a,ue(e),o,n,i);if(!t||Fe){var f,c,s,l,d,p,v={isRoot:Fe,currentPage:Re,scope:Me,isWatch:De};Fe=0;for(var m=function(){var e=l.idx,n=l.stack,t=l.type;s=n.node,Re=d=n.page,Me=ve(n),d?p=d.reg:Me&&(p=Me.reg);var a=!!d,o=!!Me,i={fail:0,scope:s.scope};f=c=0;for(var u=e;u<s.seq.length&&!f;u++){var m=s.seq[u];if(m.order){var g=m.order,h=g.priority,y=g.barrierID,b=y?d?d.fullID+"_"+y:y:0;if(u!==e||t!==h)return y?qe.has(b)||(qe.add(b),Ne(u,n,h,y)):Ne(u,n,h),"continue|kernelLoop";y&&qe.delete(b)}switch(m.type){case'mov':var x=m.data,k=void 0;switch(x.from){case S:k=le(n);break;case"a":case'b':k=n[x.from];break;case"value":k=x.store;break;case"store":if(p&&!p[x.store.id])if(a){var w=Pe(d,x.store.id);n.page=d=w,w?p=w.reg:o?(Ve(Me,x.store,0,1,x.softRead),p=Me.reg):p=void 0}else o&&Ve(Me,x.store,0,1,x.softRead);k=ne(p&&p[x.store.id]||x.store)}switch(x.to){case S:n.value=k;break;case"a":case'b':n[x.to]=k;break;case"store":Ee(d,Me,s,x.target).current=k}break;case'compute':var A=m.data;if(A.fn){De='watch'===me(s,'op');var j=A.safe?(0,A.fn)(le(n),i.scope,n):Le(i,A.fn,n);A.filter?c=!j:n.value=j,De=v.isWatch}}f=i.fail||c}if(!f){var M=le(n);r(s.next,(function(e){Ie('child',d,e,n,M,ve(n))}));var C=ve(n);if(C){me(s,'needFxCounter')&&Ie('child',d,C.fxCount,n,M,C),me(s,'storeChange')&&Ie('child',d,C.storeChange,n,M,C);var I=C.additionalLinks[s.id];I&&r(I,(function(e){Ie('child',d,e,n,M,C)}))}}};l=Ce();)m();Fe=v.isRoot,Re=v.currentPage,Me=ve(v)}}function i(r,n){void 0===n&&(n='combine');var t=n+'(',a='',o=0;return e(r,(function(e){o<25&&(null!=e&&(t+=a,t+=A(e)?Be(e).fullName:e.toString()),o+=1,a=', ')})),t+')'}function u(e,r){var n,t,a=e;if(r){var o=Be(r);0===e.length?(n=o.path,t=o.fullName):(n=o.path.concat([e]),t=0===o.fullName.length?e:o.fullName+'/'+e)}else n=0===e.length?[]:[e],t=e;return{shortName:a,fullName:t,path:n}}function f(e,r){var n=r?e:e[0];return V(n),n.and&&(e=n.and),[e,n.or]}function c(e){var r=be();if(r){for(var n=r.handlers[e],t=arguments.length,a=new Array(t>1?t-1:0),o=1;o<t;o++)a[o-1]=arguments[o];if(n)return n.apply(void 0,[r].concat(a))}}function s(e,r,n,t){var a=Re,o=null;if(r)for(o=Re;o&&o.template!==r;)o=pe(o);ze(o);var i=e.create(n,t);return ze(a),i}function l(e,r){var n=function e(r){_(!me(e,'derived'),'call of derived event','createEvent');for(var n=arguments.length,a=new Array(n>1?n-1:0),o=1;o<n;o++)a[o-1]=arguments[o];return Re?s(e,t,r,a):e.create(r,a)},t=be();return Object.assign(n,{graphite:a({meta:Ye("event",n,e,r),regional:1}),create:function(e){return o({target:n,params:e,scope:Me}),e},watch:function(e){return Qe(n,e)},map:function(e){return $e(n,w,e,[Q({fn:ie})])},filter:function(e){return $e(n,"filter",e.fn?e:e.fn,[X({fn:ie})])},filterMap:function(e){return $e(n,'filterMap',e,[Q({fn:ie}),Z((function(e){return!E(e)}),1)])},prepend:function(e){var r=l('* \u2192 '+n.shortName,{parent:pe(n)});return c('eventPrepend',ue(r)),Ke(r,n,[Q({fn:ie})],'prepend',e),Xe(n,r),r}})}function d(e,t){var i=re(e),u=Ze('updates');c('storeBase',i);var f=i.id,s={subscribers:new Map,updates:u,defaultState:e,stateRef:i,getState:function(){var e,r=i;if(Re){for(var n=Re;n&&!n.reg[f];)n=pe(n);n&&(e=n)}return!e&&Me&&(Ve(Me,i,1),e=Me),e&&(r=e.reg[f]),ne(r)},setState:function(e){return o({target:s,params:e,defer:1,scope:Me})},reset:function(){for(var e=arguments.length,n=new Array(e),t=0;t<e;t++)n[t]=arguments[t];return r(n,(function(e){return s.on(e,(function(){return s.defaultState}))})),s},on:function(e,n){return B(e,'.on','first argument'),_(!me(s,'derived'),'.on in derived store','createStore'),r(Array.isArray(e)?e:[e],(function(e){s.off(e),de(s).set(e,Je(er(e,s,'on',oe,n)))})),s},off:function(e){var r=de(s).get(e);return r&&(r(),de(s).delete(e)),s},map:function(e,r){var n,t;z(e)&&(n=e,e=e.fn),_(E(r),'second argument of store.map','updateFilter');var a=s.getState();be()?t=null:E(a)||(t=e(a,r));var o=d(t,{name:s.shortName+" \u2192 *",derived:1,and:n}),u=er(s,o,w,ae,e);return te(se(o),{type:w,fn:e,from:i}),se(o).noInit=1,c('storeMap',i,u),o},watch:function(e,r){if(!r||!A(e)){var t=Qe(s,e);return c('storeWatch',i,e)||e(s.getState()),t}return n(P(r),'second argument should be a function'),e.watch((function(e){return r(s.getState(),e)}))}},l=Ye("store",s,t),p=s.defaultConfig.updateFilter;s.graphite=a({scope:{state:i,fn:p},node:[Z((function(e,r,n){return n.scope&&!n.scope.reg[i.id]&&(n.b=1),e})),$(i),Z((function(e,r,n){var t=n.a,a=n.b;return!E(e)&&(e!==t||a)}),1),p&&X({fn:ae}),K({from:S,target:i})],child:u,meta:l,regional:1});var v=me(s,'sid');return v&&('ignore'!==me(s,'serialize')&&ge(s,'storeChange',1),i.sid=v),n(me(s,'derived')||!E(e),"current state can't be undefined, use null instead"),he(s,[u]),s}function p(){for(var e=arguments.length,r=new Array(e),t=0;t<e;t++)r[t]=arguments[t];var a,o,i,u=f(r);i=u[1];var c,s,l,d=(r=u[0])[r.length-1];if(P(d)?(o=r.slice(0,-1),a=d):o=r,1===o.length){var p=o[0];M(p)||(c=p,s=1)}if(!s&&(c=o,a)){l=1;var v=a;a=function(e){return v.apply(void 0,e)}}return n(z(c),'shape should be an object'),rr(Array.isArray(c),!l,c,i,a)}function v(){var e={};return e.req=new Promise((function(r,n){e.rs=r,e.rj=n})),e.req.catch((function(){})),e}function m(e,r){var t=l(P(e)?{handler:e}:e,r),i=ue(t);ge(i,'op',t.kind="effect"),t.use=function(e){return n(P(e),'.use argument should be a function'),m.scope.handler=e,t},t.use.getCurrent=function(){return m.scope.handler};var u=t.finally=Ze('finally'),f=t.done=u.filterMap({named:'done',fn:function(e){if('done'===e.status)return{params:e.params,result:e.result}}}),c=t.fail=u.filterMap({named:'fail',fn:function(e){if('fail'===e.status)return{params:e.params,error:e.error}}}),s=t.doneData=f.map({named:'doneData',fn:function(e){return e.result}}),p=t.failData=c.map({named:'failData',fn:function(e){return e.error}}),m=a({scope:{handlerId:me(i,'sid'),handler:t.defaultConfig.handler||function(){return n(0,"no handler used in "+t.getType())}},node:[Z((function(e,r,n){var t=r,a=t.handler;if(ve(n)){var o=ve(n).handlers[t.handlerId];o&&(a=o)}return e.handler=a,e}),0,1),Z((function(e,r,n){var t=e.params,a=e.req,o=e.handler,i=e.args,f=void 0===i?[t]:i,c=tr(t,a,1,u,n),s=tr(t,a,0,u,n),l=nr(o,s,f),d=l[1];l[0]&&(z(d)&&P(d.then)?d.then(c,s):c(d))}),0,1)],meta:{op:'fx',fx:'runner'}});i.scope.runner=m,R(i.seq,Z((function(e,r,n){var t=r.runner,a=pe(n)?{params:e,req:{rs:function(){},rj:function(){}}}:e;return o({target:t,params:a,defer:1,scope:ve(n)}),a.params}),0,1)),t.create=function(e){var r=v(),n={params:e,req:r};if(Me){if(!De){var a=Me;r.req.finally((function(){_e(a)})).catch((function(){}))}o({target:t,params:n,scope:Me})}else o(t,n);return r.req};var g=t.inFlight=d(0,{named:'inFlight'}).on(t,(function(e){return e+1})).on(u,(function(e){return e-1}));ge(u,'needFxCounter','dec'),ge(t,'needFxCounter',1);var h=t.pending=g.map({fn:function(e){return e>0},named:'pending'});return he(t,[u,f,c,s,p,h,g]),t}function g(e,r){var n=l(r||i(e,'merge'));return B(e,'merge','first argument'),Ke(e,n,[],'merge'),n}function h(e,t){var a=0;return r(or,(function(r){r in e&&(n(null!=e[r],ir(t,r)),a=1)})),a}function y(){for(var e,r,n=arguments.length,t=new Array(n),o=0;o<n;o++)t[o]=arguments[o];var i,u=f(t),s=u[0],p=s[0],v=s[1],m=s[2],g=u[1],y=1;E(v)&&z(p)&&h(p,'sample')&&(v=p.clock,m=p.fn,y=!p.greedy,e=p.target,r=p.name,i=p.sid,p=p.source);var b=ur(p,v,'sample');p=b[0],E(v=b[1])&&(v=p),B(v,'sample','clock'),g||r||(r=p.shortName);var x=!!e;if(!e)if(M(p)&&M(v)){var k=m?m(ne(se(p)),ne(se(v))):ne(se(p));e=d(k,{name:r,sid:i,or:g})}else e=l(r,g),c('sampleTarget',ue(e));if(M(p)){var w=se(p);he(p,[Ke(v,e,[c('sampleSourceLoader'),$(w,!m,y),m&&Q({fn:oe}),c('sampleSourceUpward',x)],"sample",m)]),c('sampleStoreSource',w)}else{var A=re(0),j=re(),C=re();c('sampleNonStoreSource',A,j,C),a({parent:p,node:[K({from:S,target:j}),K({from:"value",store:1,target:A})],family:{owners:[p,e,v],links:e},meta:{op:"sample"},regional:1}),he(p,[Ke(v,e,[c('sampleSourceLoader'),K({from:S,target:C}),$(A,1),Z((function(e){return e}),1),$(j,1,y),$(C),m&&Q({fn:ae}),c('sampleSourceUpward',x)],"sample",m)])}return e}function b(e,n){var t=[];(function e(a){F(t,a)||(R(t,a),"store"===me(a,'op')&&me(a,'sid')&&n(a,me(a,'sid')),r(a.next,e),r(fe(a),e),r(ce(a),e))})(e)}function x(e,t){if(Array.isArray(e)&&(e=new Map(e)),e instanceof Map){var a={};return r(e,(function(e,r){n(A(r),'Map key should be a unit'),t&&t(r,e),n(r.sid,'unit should have a sid'),n(!(r.sid in a),'duplicate sid found'),a[r.sid]=e})),a}return e}Object.defineProperty(exports,'__esModule',{value:1});for(var k='undefined'!=typeof Symbol&&Symbol.observable||'@@observable',w='map',S='stack',A=function(e){return(P(e)||z(e))&&'kind'in e},j=function(e){return function(r){return A(r)&&r.kind===e}},M=j("store"),C=j("event"),I=j("effect"),N=j("domain"),O=j("scope"),q={__proto__:null,unit:A,store:M,event:C,effect:I,domain:N,scope:O},F=function(e,r){return e.includes(r)},D=function(e,r){var n=e.indexOf(r);-1!==n&&e.splice(n,1)},R=function(e,r){return e.push(r)},_=function(e,r,n){return!e&&console.error(r+" is deprecated, use "+n+" instead")},z=function(e){return'object'==typeof e&&null!==e},P=function(e){return'function'==typeof e},E=function(e){return void 0===e},V=function(e){return n(z(e)||P(e),'expect first argument be an object')},L=function(e,r,t,a){return n(!(!z(e)&&!P(e)||!('family'in e)&&!('graphite'in e)),r+": expect "+t+" to be a unit (store, event or effect)"+a)},B=function(e,n,t){Array.isArray(e)?r(e,(function(e,r){return L(e,n,r+" item of "+t,'')})):L(e,n,t,' or array of units')},T=function(){var e=0;return function(){return""+ ++e}},W=T(),U=T(),H=T(),G=function(e,r,n,t){var a={id:U(),type:e,data:r};return n&&(a.order={priority:n},t&&(a.order.barrierID=++J)),a},J=0,K=function(e){var r=e.from,n=e.target,t=e.to;return G('mov',{from:void 0===r?"store":r,store:e.store,to:void 0===t?n?"store":S:t,target:n},e.priority,e.batch)},Q=function(e){var r=e.safe,n=e.filter;return G('compute',{fn:e.fn,safe:void 0===r?0:r,filter:void 0===n?0:n},e.priority,e.batch)},X=function(e){return Q({fn:e.fn,filter:1})},Y=function(e){return Q({fn:e.fn,priority:"effect"})},Z=function(e,r,n){return Q({fn:e,safe:1,filter:r,priority:n&&"effect"})},$=function(e,r,n){return K({store:e,to:r?S:"a",priority:n&&"sampler",batch:1})},ee={mov:K,compute:Q,filter:X,run:Y},re=function(e){return{id:U(),current:e}},ne=function(e){return e.current},te=function(e,r){e.before||(e.before=[]),R(e.before,r)},ae=function(e,r,n){return(0,r.fn)(e,n.a)},oe=function(e,r,n){return(0,r.fn)(n.a,e)},ie=function(e,r){return(0,r.fn)(e)},ue=function(e){return e.graphite||e},fe=function(e){return e.family.owners},ce=function(e){return e.family.links},se=function(e){return e.stateRef},le=function(e){return e.value},de=function(e){return e.subscribers},pe=function(e){return e.parent},ve=function(e){return e.scope},me=function(e,r){return ue(e).meta[r]},ge=function(e,r,n){return ue(e).meta[r]=n},he=function(e,n){var t=ue(e);r(n,(function(e){var r=ue(e);"domain"!==t.family.type&&(r.family.type="crosslink"),R(fe(r),t),R(ce(t),r)}))},ye=null,be=function(){return ye&&ye.template},xe=function(e){return e&&ye&&ye.sidRoot&&(e=ye.sidRoot+"|"+e),e},ke=function(e){return void 0===e&&(e=[]),(Array.isArray(e)?e:[e]).flat().map(ue)},we=null,Se=function e(r,n){return r?n?((r.v.type===n.v.type&&r.v.id>n.v.id||Oe(r.v.type)>Oe(n.v.type))&&(t=r,r=n,n=t),t=e(r.r,n),r.r=r.l,r.l=t,r):r:n;var t},Ae=[],je=0;je<6;)R(Ae,{first:null,last:null,size:0}),je+=1;var Me,Ce=function(){for(var e=0;e<6;e++){var r=Ae[e];if(r.size>0){if(3===e||4===e){r.size-=1;var n=we.v;return we=Se(we.l,we.r),n}1===r.size&&(r.last=null);var t=r.first;return r.first=t.r,r.size-=1,t.v}}},Ie=function(e,r,n,t,a,o){return Ne(0,{a:null,b:null,node:n,parent:t,value:a,page:r,scope:o},e)},Ne=function(e,r,n,t){void 0===t&&(t=0);var a=Oe(n),o=Ae[a],i={v:{idx:e,stack:r,type:n,id:t},l:null,r:null};3===a||4===a?we=Se(we,i):(0===o.size?o.first=i:o.last.r=i,o.last=i),o.size+=1},Oe=function(e){switch(e){case'child':return 0;case'pure':return 1;case'read':return 2;case"barrier":return 3;case"sampler":return 4;case"effect":return 5;default:return-1}},qe=new Set,Fe=1,De=0,Re=null,_e=function(e){Me=e},ze=function(e){Re=e},Pe=function(e,r){if(e){for(;e&&!e.reg[r];)e=pe(e);if(e)return e}return null},Ee=function(e,r,n,t,a){var o=Pe(e,t.id);return o?o.reg[t.id]:r?(Ve(r,t,a),r.reg[t.id]):t},Ve=function e(n,t,a,o,i){var u=n.reg,f=t.sid;if(!u[t.id]){var c={id:t.id,current:t.current};if(f&&f in n.sidValuesMap&&!(f in n.sidIdMap))c.current=n.sidValuesMap[f];else if(t.before&&!i){var s=0,l=a||!t.noInit||o;r(t.before,(function(r){switch(r.type){case w:var t=r.from;if(t||r.fn){t&&e(n,t,a,o);var i=t&&u[t.id].current;l&&(c.current=r.fn?r.fn(i):i)}break;case'field':s||(s=1,c.current=Array.isArray(c.current)?[].concat(c.current):Object.assign({},c.current)),e(n,r.from,a,o),l&&(c.current[r.field]=u[u[r.from.id].id].current)}}))}f&&(n.sidIdMap[f]=t.id),u[t.id]=c}},Le=function(e,r,n){try{return r(le(n),e.scope,n)}catch(t){console.error(t),e.fail=1}},Be=function(e){return e.compositeName},Te=function r(n,t){return void 0===t&&(t={}),z(n)&&(r(n.or,t),e(n,(function(e,r){E(e)||'or'===r||'and'===r||(t[r]=e)})),r(n.and,t)),t},We=function(e,r){D(e.next,r),D(fe(e),r),D(ce(e),r)},Ue=function e(r,n,t){var a;r.next.length=0,r.seq.length=0,r.scope=null;for(var o=ce(r);a=o.pop();)We(a,r),(n||t&&'sample'!==me(r,'op')||"crosslink"===a.family.type)&&e(a,n,'on'!==me(a,'op')&&t);for(o=fe(r);a=o.pop();)We(a,r),t&&"crosslink"===a.family.type&&e(a,n,'on'!==me(a,'op')&&t)},He=function(e){return e.clear()},Ge=function(e,r){var n=(void 0===r?{}:r).deep,t=0;if(e.ownerSet&&e.ownerSet.delete(e),M(e))He(de(e));else if(N(e)){t=1;var a=e.history;He(a.events),He(a.effects),He(a.stores),He(a.domains)}Ue(ue(e),!!n,t)},Je=function(e){var r=function(){return Ge(e)};return r.unsubscribe=r,r},Ke=function(e,r,n,t,o){return a({node:n,parent:e,child:r,scope:{fn:o},meta:{op:t},family:{owners:[e,r],links:r},regional:1})},Qe=function(e,r){return n(P(r),'.watch argument should be a function'),Je(a({scope:{fn:r},node:[Y({fn:ie})],parent:e,meta:{op:'watch'},family:{owners:e},regional:1}))},Xe=function(e,r,n){void 0===n&&(n="event"),pe(e)&&pe(e).hooks[n](r)},Ye=function(e,r,n,t){var a="domain"===e,o=W(),i=Te({or:t,and:'string'==typeof n?{name:n}:n}),f=i.parent,c=void 0===f?null:f,s=i.sid,l=void 0===s?null:s,d=i.named,p=void 0===d?null:d,v=p||i.name||(a?'':o),m=u(v,c),g={op:r.kind=e,name:r.shortName=v,sid:r.sid=xe(l),named:p,unitId:r.id=o,serialize:i.serialize,derived:i.derived};if(r.parent=c,r.compositeName=m,r.defaultConfig=i,r.thru=function(e){return _(0,'thru','js pipe'),e(r)},r.getType=function(){return m.fullName},!a){r.subscribe=function(e){return V(e),r.watch(P(e)?e:function(r){return e.next&&e.next(r)})},r[k]=function(){return r};var h=be();h&&(g.nativeTemplate=h)}return g},Ze=function(e){return l({named:e})},$e=function(e,r,n,t){var a;z(n)&&(a=n,n=n.fn);var o=l({name:e.shortName+" \u2192 *",derived:1,and:a});return Ke(e,o,t,r,n),o},er=function(e,r,n,t,a){var o=se(r),i=K({store:o,to:"a",priority:'read'});n===w&&(i.data.softRead=1);var u=[i,Q({fn:t})];return c('storeOnMap',o,u,M(e)&&se(e)),Ke(e,r,u,n,a)},rr=function(r,t,a,o,u){var f=r?function(e){return e.slice()}:function(e){return Object.assign({},e)},s=r?[]:{},l=f(s),p=re(l),v=re(1);p.type=r?'list':'shape',p.noInit=1,c('combineBase',p,v);var m=d(l,{name:i(a),derived:1,and:o}),g=se(m);g.noInit=1,ge(m,'isCombine',1);var h=[Z((function(e,r,n){return n.scope&&!n.scope.reg[p.id]&&(n.c=1),e})),$(p),K({store:v,to:'b'}),Z((function(e,r,n){var a=r.key;if(n.c||e!==n.a[a])return t&&n.b&&(n.a=f(n.a)),n.a[a]=e,1}),1),K({from:"a",target:p}),K({from:"value",store:0,target:v}),K({from:"value",store:1,target:v,priority:"barrier",batch:1}),$(p,1),u&&Q({fn:ie})];return e(a,(function(e,r){if(!M(e))return n(!A(e)&&!E(e),"combine expects a store in a field "+r),void(l[r]=s[r]=e);s[r]=e.defaultState,l[r]=e.getState();var t=Ke(e,m,h,'combine',u);t.scope.key=r;var a=se(e);te(p,{type:'field',field:r,from:a}),c('combineField',a,t)})),m.defaultShape=a,te(g,{type:w,from:p,fn:u}),be()||(m.defaultState=u?g.current=u(l):s),m},nr=function(e,r,n){try{return[1,e.apply(void 0,n)]}catch(t){return r(t),[0,null]}},tr=function(e,r,n,t,a){return function(i){return o({target:[t,ar],params:[n?{status:'done',params:e,result:i}:{status:'fail',params:e,error:i},{value:i,fn:n?r.rs:r.rj}],defer:1,page:a.page,scope:ve(a)})}},ar=a({node:[Y({fn:function(e){return(0,e.fn)(e.value)}})],meta:{op:'fx',fx:'sidechain'}}),or=['source','clock','target'],ir=function(e,r){return e+": "+r+" should be defined"},ur=function(e,r,t){return n(!E(e)||!E(r),ir(t,'either source or clock')),E(e)?(B(r,t,'clock'),Array.isArray(r)&&(r=g(r)),e=r):A(e)||(e=p(e)),[e,r]},fr=function(e,r,n,t){var a=e[r];a&&o({target:a,params:Array.isArray(a)?a.map((function(){return n})):n,defer:1,stack:t})};exports.allSettled=function(e,r){var n=r.scope,t=r.params;if(!A(e))return Promise.reject(Error('first argument should be unit'));var a=v();a.parentFork=Me;var i=n.fxCount;R(i.scope.defers,a);var u=[e],f=[];return R(f,I(e)?{params:t,req:{rs:function(e){a.value={status:'done',value:e}},rj:function(e){a.value={status:'fail',value:e}}}}:t),R(u,i),R(f,null),o({target:u,params:f,scope:n}),a.req},exports.attach=function(e){var r,n=f(e,1),t=(e=n[0]).source,a=e.effect,i=e.mapParams,u=m(e,n[1]);ge(u,'attached',1);var c,s,l=ue(u).scope.runner,d=Z((function(e,r,n){var a,f=e.params,c=e.req,s=e.handler,l=u.finally,d=tr(f,c,0,l,n),p=n.a,v=I(s),m=1;if(i){var g=nr(i,d,[f,p]);m=g[0],a=g[1]}else a=t&&v?p:f;if(m){if(!v)return e.args=[p,a],1;o({target:s,params:{params:a,req:{rs:tr(f,c,1,l,n),rj:d}},page:n.page,defer:1})}}),1,1);return t?(M(t)?he(s=t,[u]):(s=p(t),he(u,[s])),c=[$(se(s)),d]):c=[d],(r=l.seq).splice.apply(r,[1,0].concat(c)),u.use(a),Xe(a,u,"effect"),u},exports.clearNode=Ge,exports.combine=p,exports.createApi=function(){for(var r=arguments.length,n=new Array(r),t=0;t<r;t++)n[t]=arguments[t];var a=f(n),o=a[0],i=o[0],u=o[1],c=a[1],s={};return e(u,(function(e,r){var n=s[r]=l(r,{parent:pe(i),config:c});i.on(n,e),Xe(i,n)})),s},exports.createDomain=function n(t,i){var u=a({family:{type:"domain"},regional:1}),f={history:{},graphite:u,hooks:{}};u.meta=Ye("domain",f,t,i),e({Event:l,Effect:m,Store:d,Domain:n},(function(e,n){var t=n.toLowerCase(),a=Ze("on"+n);f.hooks[t]=a;var i=new Set;f.history[t+"s"]=i,a.create=function(e){return o(a,e),e},R(ue(a).seq,Z((function(e,r,n){return n.scope=null,e}))),a.watch((function(e){he(f,[e]),i.add(e),e.ownerSet||(e.ownerSet=i),pe(e)||(e.parent=f)})),he(f,[a]),f["onCreate"+n]=function(e){return r(i,e),a.watch(e)},f["create"+n]=f[t]=function(r,n){return a(e(r,{parent:f,or:n}))}}));var c=pe(f);return c&&e(f.hooks,(function(e,r){return Ke(e,c.hooks[r])})),f},exports.createEffect=m,exports.createEvent=l,exports.createNode=a,exports.createStore=d,exports.createStoreObject=function(){return _(0,'createStoreObject','combine'),p.apply(void 0,arguments)},exports.fork=function(e,t){var o,i=e;N(e)&&(o=e,i=t);var u=function(e){var n=a({scope:{defers:[],inFlight:0,fxID:0},node:[Z((function(e,r,n){pe(n)?'dec'===me(pe(n).node,'needFxCounter')?r.inFlight-=1:(r.inFlight+=1,r.fxID+=1):r.fxID+=1})),Q({priority:"sampler",batch:1}),Z((function(e,n){var t=n.defers,a=n.fxID;n.inFlight>0||0===t.length||Promise.resolve().then((function(){n.fxID===a&&r(t.splice(0,t.length),(function(e){_e(e.parentFork),e.rs(e.value)}))}))}),0,1)]}),t=a({node:[Z((function(e,r,n){var t=pe(n);if(t&&pe(t)){var a=t.node;if(!me(a,'isCombine')||'combine'!==me(pe(t).node,'op')){var o=ve(n),i=a.scope.state.id,u=me(a,'sid');o.sidIdMap[u]=i,o.sidValuesMap[u]=e}}}))]}),o={cloneOf:e,reg:{},sidValuesMap:{},sidIdMap:{},getState:function(e){if('current'in e)return Ee(Re,o,null,e).current;var r=ue(e);return Ee(Re,o,r,r.scope.state,1).current},kind:"scope",graphite:a({family:{type:"domain",links:[n,t]},meta:{unit:'fork'},scope:{forkInFlightCounter:n}}),additionalLinks:{},handlers:{},fxCount:n,storeChange:t};return o}(o);if(i){if(i.values){var f=x(i.values,(function(e){return n(M(e),'Values map can contain only stores as keys')}));Object.assign(u.sidValuesMap,f)}i.handlers&&(u.handlers=x(i.handlers,(function(e){return n(I(e),"Handlers map can contain only effects as keys")})))}return u},exports.forward=function(e){var r=f(e,1),n=r[0],t=n.from,o=n.to,i=r[1];return B(t,'forward','"from"'),B(o,'forward','"to"'),Je(a({parent:t,child:o,meta:{op:'forward',config:i},family:{},regional:1}))},exports.fromObservable=function(e){V(e);var r=k in e?e[k]():e;n(r.subscribe,'expect observable to have .subscribe');var t=l(),a=Je(t);return r.subscribe({next:t,error:a,complete:a}),t},exports.guard=function(){for(var e='guard',r=arguments.length,t=new Array(r),o=0;o<r;o++)t[o]=arguments[o];var i=f(t),u=i[0],c=u[0],s=u[1],d=i[1];s||(c=(s=c).source),h(s,e);var p=s,v=p.filter,m=p.greedy,g=p.clock,b=p.name,x=void 0===b?d&&d.name?d.name:e:b,k=s.target||l(x,d),w=A(v),S=ur(c,g,e);return c=S[0],(g=S[1])&&(B(g,e,'clock'),c=y({source:c,clock:g,greedy:m,fn:w?null:function(e,r){return{source:e,clock:r}}})),B(k,e,'target'),w?y({source:v,clock:c,target:a({node:[Z((function(e){return e.guard}),1),Z((function(e){return e.data}))],child:k,meta:{op:e},family:{owners:[c,v,k].concat([].concat(g||[])),links:k},regional:1}),fn:function(e,r){return{guard:e,data:r}},greedy:m,name:x}):(n(P(v),'`filter` should be function or unit'),Ke(c,k,g?[X({fn:function(e,r){return(0,r.fn)(e.source,e.clock)}}),Z((function(e){return e.source}))]:[X({fn:ie})],e,v)),k},exports.hydrate=function(e,r){var t=r.values;n(z(t),'values property should be an object');var a,i,u,f=x(t),c=Object.getOwnPropertyNames(f),s=[],l=[];O(e)?(u=1,n((a=e).cloneOf,'scope should be created from domain'),i=ue(a.cloneOf)):N(e)?i=ue(e):n(0,'first argument of hydrate should be domain or scope'),b(i,(function(e,r){F(c,r)&&(R(s,e),R(l,f[r]))})),o({target:s,params:l,scope:a}),u&&Object.assign(a.sidValuesMap,f)},exports.is=q,exports.launch=o,exports.merge=g,exports.restore=function(r,n,t){if(M(r))return r;if(C(r)||I(r)){var a=pe(r),o=d(n,{parent:a,name:r.shortName,and:t});return Ke(I(r)?r.doneData:r,o),a&&a.hooks.store(o),o}var i=Array.isArray(r)?[]:{};return e(r,(function(e,r){return i[r]=M(e)?e:d(e,{name:r})})),i},exports.sample=y,exports.scopeBind=function(e,r){var t=(void 0===r?{}:r).scope;n(t||Me,'scopeBind cannot be called outside of forked .watch');var a=t||Me;return I(e)?function(r){var n=v();return o({target:e,params:{params:r,req:n},scope:a}),n.req}:function(r){return o({target:e,params:r,scope:a}),r}},exports.serialize=function(r,t){void 0===t&&(t={});var a=t.ignore?t.ignore.map((function(e){return e.sid})):[],o={};return e(r.sidValuesMap,(function(e,n){if(!F(a,n)){var t=r.sidIdMap[n];o[n]=t&&t in r.reg?r.reg[t].current:e}})),'onlyChanges'in t&&!t.onlyChanges&&(n(r.cloneOf,'scope should be created from domain'),b(ue(r.cloneOf),(function(e,n){n in o||F(a,n)||me(e,'isCombine')||'ignore'===me(e,'serialize')||(o[n]=r.getState(e))}))),o},exports.setStoreName=function(e,r){e.shortName=r,Object.assign(Be(e),u(r,pe(e)))},exports.split=function(){for(var r,t=arguments.length,o=new Array(t),i=0;i<t;i++)o[i]=arguments[i];var u=f(o),s=u[0],d=s[0],p=s[1],v=u[1],m=!p;m&&(r=d.cases,p=d.match,d=d.source);var g=M(p),h=!A(p)&&P(p),y=!g&&!h&&z(p);r||(r={}),m||(n(y,'match should be an object'),e(p,(function(e,n){return r[n]=l(v)})),r.__=l(v));var b,x=new Set([].concat(d,Object.values(r))),k=Object.keys(g||h?r:p);if(g||h)g&&x.add(p),b=[g&&$(se(p),0,1),Q({safe:g,filter:1,fn:function(e,r,n){var t=String(g?n.a:p(e));fr(r,F(k,t)?t:'__',e,n)}})];else if(y){var w=re({});w.type='shape';var S,j=[];e(p,(function(e,r){if(A(e)){S=1,R(j,r),x.add(e);var n=Ke(e,[],[$(w),Z((function(e,n,t){return t.a[r]=e}))]);if(M(e)){w.current[r]=e.getState();var t=se(e);te(w,{from:t,field:r,type:'field'}),c('splitMatchStore',t,n)}}})),S&&c('splitBase',w),b=[S&&$(w,0,1),X({fn:function(e,r,n){for(var t=0;t<k.length;t++){var a=k[t];if(F(j,a)?n.a[a]:p[a](e))return void fr(r,a,e,n)}fr(r,'__',e,n)}})]}else n(0,'expect match to be unit, function or object');if(a({meta:{op:'split'},parent:d,scope:r,node:b,family:{owners:Array.from(x)},regional:1}),!m)return r},exports.step=ee,exports.version="22.1.2",exports.withFactory=function(e){var r=e.name,n=e.loc,o=e.method,i=e.fn;return t(a({meta:{sidRoot:xe(e.sid),name:r,loc:n,method:o}}),i)},exports.withRegion=t;
//# sourceMappingURL=compat.js.map
