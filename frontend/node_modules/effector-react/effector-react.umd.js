((e,t)=>{'object'==typeof exports&&'undefined'!=typeof module?t(exports,require('react'),require('effector')):'function'==typeof define&&define.amd?define(['exports','react','effector'],t):t((e='undefined'!=typeof globalThis?globalThis:e||self).effectorReact={},e.React,e.effector)})(this,((e,t,effector)=>{function n(e){return e&&'object'==typeof e&&'default'in e?e:{default:e}}function r(e,t,n){let r=[effector.step.run({fn:e=>t(e)})];if(n){let t=effector.createNode({node:r}),o=e.graphite.id,u=n.additionalLinks,a=u[o]||[];return u[o]=a,a.push(t),()=>{let e=a.indexOf(t);-1!==e&&a.splice(e,1),effector.clearNode(t)}}{let t=effector.createNode({node:r,parent:[e],family:{owners:e}});return()=>{effector.clearNode(t)}}}function o(e,t){return t.displayName=e,t}function u(e,t){effector.is.store(e)||p('expect useStore argument to be a store');let n=m(e,t),o=v(),u=i.default.useRef({store:e,value:n,pending:0});return d((()=>{let n=r(e,(e=>{let t=u.current;t.pending||(t.value=e,t.pending=1,o(),t.pending=0)}),t),a=m(e,t),l=u.current;return l.store===e&&l.value!==a&&(l.value=a,l.pending=1,o(),l.pending=0),l.store=e,n}),[e,t]),n}function a([e,t],n){let o,u,a,s=y;t?(o=t,u=e,a=[]):(o=e.fn,u=e.store,a=e.keys,s=e.updateFilter||y),effector.is.store(u)||p('useStoreMap expects a store'),Array.isArray(a)||p('useStoreMap expects an array as keys'),'function'!=typeof o&&p('useStoreMap expects a function');let c=i.default.useRef({}),f=c.current;f.fn=o,f.upd=s,f.init=f.store===u,f.store=u;let g=v(),k=[n,...a],h=i.default.useMemo((()=>(l(m(u,n),a,c.current),r(u,(e=>l(e,a,c.current,g)),n))),k);return d((()=>()=>h()),k),f.val}function l(e,t,n,r){let o=n.fn(e,t);n.init?void 0!==o&&y(o,n.val)&&n.upd(o,n.val)&&(n.val=o,r&&r()):(n.val=o,n.init=1)}function s(e){return u(e)}function c(e,t){function n(e){let n=i.default.useRef(e),o=s(r);d((()=>(a({props:n.current,state:r.getState()}),()=>{l({props:n.current,state:r.getState()})})),[]);let u=t(e,o);return n.current=e,u}let r;effector.is.store(e)?r=e:'object'==typeof e&&null!==e?r=effector.combine(e):p('shape should be a store or object with stores');let u='Unknown';r&&r.shortName&&(u=r.shortName);let a=effector.createEvent(),l=effector.createEvent();return n.mounted=a,n.unmounted=l,o(`${u}.View`,n)}function f(e,t={}){let n=i.default.useRef({value:null,count:0});d((()=>(e.open(n.current.value),()=>e.close(n.current.value))),[e]),((e,t)=>{if(e===t)return 1;if('object'==typeof e&&null!==e&&'object'==typeof t&&null!==t){let n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return 0;for(let r=0;r<n.length;r++){let o=n[r];if(e[o]!==t[o])return 0}return 1}return 0})(n.current.value,t)||(n.current.value=t,n.current.count+=1),d((()=>{e.set(n.current.value)}),[n.current.count])}var i=n(t);let d='undefined'!=typeof window?i.default.useLayoutEffect:i.default.useEffect,p=e=>{throw Error(e)};const m=(e,t)=>t?t.getState(e):e.getState(),y=(e,t)=>e!==t,v=()=>i.default.useReducer((e=>e+1),0)[1];let g=e=>console.error(`${e} is deprecated`),k=e=>t=>{let n=e;return'function'!=typeof e&&(n=t,t=e),o(`Connect(${n.displayName||n.name||'Unknown'})`,(e=>i.default.createElement(n,{...e,...s(t)})))};e.connect=k,e.createComponent=c,e.createContextComponent=(e,t,n)=>(g('createContextComponent'),o(`${e.shortName||'Unknown'}.ContextComponent`,(r=>{let o=i.default.useContext(t),u=s(e);return n(r,u,o)}))),e.createGate=(e="gate",t={})=>{let n;return'object'==typeof e&&null!==e&&('defaultState'in e&&(t=e.defaultState),e.domain&&(n=e.domain),e=e.name),(({name:e="gate",domain:t,defaultState:n,hook:r})=>{function u(e){return r(u,e),null}let a=`${t?`${t.compositeName.fullName}/`:''}${e}`,l=effector.createEvent(`${a}.set`),s=effector.createEvent(`${a}.open`),c=effector.createEvent(`${a}.close`),f=effector.createStore(Boolean(0),{name:`${a}.status`}).on(s,(()=>Boolean(1))).on(c,(()=>Boolean(0))),i=effector.createStore(n,{name:`${a}.state`}).on(l,((e,t)=>t)).reset(c);if(t){let{hooks:e}=t;effector.launch({target:[e.store,e.store,e.event,e.event,e.event],params:[f,i,s,c,l]})}return u.open=s,u.close=c,u.status=f,u.state=i,u.set=l,o(`Gate:${a}`,u)})({name:e,domain:n,defaultState:t,hook:f})},e.createReactState=(e,t)=>(g('createReactState'),k(t)(e)),e.createStoreConsumer=e=>c(e,(({children:e},t)=>e(t))),e.useEvent=e=>e,e.useGate=f,e.useList=(e,t)=>((e,t,n)=>{let r,l,s=[];'object'==typeof t&&null!==t?(t.keys&&(s=t.keys),r=t.fn,t.getKey&&(l=t.getKey)):r=t,effector.is.store(e)||p('expect useList first argument to be a store'),'function'!=typeof r&&p("expect useList's renderItem to be a function"),Array.isArray(s)||p("expect useList's keys to be an array");let c=i.default.useMemo((()=>{let t=o(`${e.shortName||'Unknown'}.Item`,(t=>{let{index:r,keys:o,keyVal:u,value:l}=t;if(f.current[1])return f.current[0](l,u);let s=a([{store:e,keys:[r,...o],fn:(e,t)=>e[t[0]]}],n);return f.current[0](s,r)}));return i.default.memo(t)}),[e,n,!!l]),f=i.default.useRef([r,l]);f.current=[r,l];let d=i.default.useMemo((()=>s),s);if(l)return u(e,n).map((e=>{let t=f.current[1](e);return i.default.createElement(c,{keyVal:t,key:t,keys:d,value:e})}));{let t=a([{store:e,keys:[e],fn:e=>e.length}],n);return Array.from({length:t},((e,t)=>i.default.createElement(c,{index:t,key:t,keys:d})))}})(e,t),e.useStore=s,e.useStoreMap=(e,t)=>a([e,t]),Object.defineProperty(e,'__esModule',{value:1})}));
//# sourceMappingURL=effector-react.umd.js.map
